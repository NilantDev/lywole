<!DOCTYPE html>
<html>
    <head>
        <meta name="google-site-verification" content="dpBr_XLcSNBLWcHKkBnTEy7D9GQMHsa_8kzDBre2z9I" />
        <meta charset="UTF-8">
        <script src="js/custom/giveup.js"></script>
        <script src="js/custom/hint.js"></script>
        <script src="js/custom/letter.js"></script>
        <script src="js/custom/lywole.js"></script>
        <script src="js/custom/score.js"></script>
        <script src="js/custom/task.js"></script>
        <script src="js/custom/word.js"></script>

        <script src="js/vendor/basil.js"></script>
        <script src="js/vendor/popup.min.js"></script>
        <script src="js/vendor/jQuery.js"></script>

        <script src="songs/lyrics_en.js"></script>
        <script src="songs/songs_en.js"></script>

        <script src="popup/content.js"></script>

        <link rel="stylesheet" href="css/main.css">
    </head>
    <body>
        <div class="main-wrapper">
            <div class="menu">
                <!-- <span id="statistic">Statistic</span> -->
                <!-- <span id="settings">Settings</span> -->
                <!-- <span id="follow">Follow</span> -->
                <span id="about">About</span>
                <script>
                    $('#about').on('click', function() {
                        let myPopup = new Popup({
                            id: "my-popup",
                            title: "",
                            content: PopupContent.about,
                        });
                        myPopup.show();

                    });
                </script>
            </div>
            <div class="lywole"><span></span></div>
            <div class="info">
                <img width="200px" id="cover" src="">
                <br>
                <div class="title">
                    <span id="artist"></span>
                    <a id="link" target="_blank">
                        <span id="song"></span>
                    </a>
                </div>
            </div>
            <div id="score-wrapper"><span>Your score: </span><span id="score"></span></div>
            <div class="input-actions">
                <input id="word">
                <div class="actions">
                    <button onclick="checkWord()" id="checkWord">Try the word!</button>
                    <button onclick="GiveUp.giveUp(words, lyrics)" id="giveUp">Give up!</button>
                    <button onclick="showHint()" id="getHint" disabled>Get hint!</button>
                </div>
            </div>
            <div id="letters" class="letter-wrapper"></div>
            <div id="attempts"></div>
            <div id="leftLetters"></div>
        </div>
        <script>
            $(document).ready(function(){
                $('#word').keypress(function(e){
                    if (e.keyCode == 13) {
                        $('#checkWord').click();
                        $('#word').val('');
                    }
                });
            });
        </script>
        <script>
            let task = Task.getTodayTask(
                getWeekSongs(),
                getWeekLyrics()
            );
            let score = 0;

            $('#cover').attr('src', task.cover);
            $('#artist').text( task.artist);
            $('#song').text( task.song);
            $('#link').attr('href', task.youtube);

            const lyrics = task.lyrics;
            let words = Word.getUniqueWords(lyrics);
            let letters = Letter.getUniqueLetters(words);

            letters.forEach(letter => {
                $('#letters').append('<span class="letter" data-letter="' + letter + '">' + letter + '</span>');
            });

            //////////////////_INIT_////////////////////////////////////

            let options = {
                namespace: 'lywoly',
                storage: 'local'
            };
            let basil = new window.Basil(options);
            let lywoly = Lywole.init(basil);
        </script>

        <script>
            function showHint() {
                let hint = Hint.getHint(lyrics);
                let myPopup = new Popup({
                    id: "my-popup",
                    title: "",
                    content: hint,
                });

                myPopup.show();

                $('#getHint').attr('disabled', true);
            }
        </script>

        <script>
            function checkWord() {
                let word = $('#word').val().toLowerCase().trim();
                let guessedLetters = Letter.getGuessedLetters(word);
                isWordIncluded = Word.isWordIncluded(word, words);

                let points = Score.getPoints(
                    word,
                    Word.isWordInTitle(word, task.song),
                    isWordIncluded,
                    guessedLetters
                );

                if (isWordIncluded) {
                    Letter.setGuessedLetters(word);

                    let hint = Hint.getHint(lyrics);

                    if (hint) {
                        $('#getHint').attr('disabled', false);
                    }
                }

                Lywole.addAttemptToDom(word, isWordIncluded, points);

                score += points;

                $('#score').text(score);
                lywoly.saveToLocalStorage(
                    score, 
                    {
                        word: word, 
                        isWordIncluded: isWordIncluded, 
                        points: points, 
                    },
                    isWordIncluded ? guessedLetters : [],
                    basil
                )
            }
        </script>
    </body>
</html>